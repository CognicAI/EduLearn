<!DOCTYPE html>
<html>
<head>
<title>User_Management_MCP.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="mcp-server--user-management">MCP Server — User Management</h1>
<h2 id="1-overview">1. Overview</h2>
<p>This MCP server is responsible for managing users within the EduLearn system. It handles the lifecycle of students, teachers, and administrators, ensuring secure access and data integrity.</p>
<p><strong>Key Responsibilities:</strong></p>
<ul>
<li><strong>CRUD Operations:</strong> Create, Read, Update, Delete users.</li>
<li><strong>Data Validation:</strong> Enforce strict rules for user data (email, roles, etc.).</li>
<li><strong>Bulk Operations:</strong> Support CSV import and export.</li>
<li><strong>Security:</strong> Enforce Role-Based Access Control (RBAC).</li>
<li><strong>Auditability:</strong> Maintain logs for all user actions.</li>
</ul>
<h2 id="2-step-by-step-implementation-plan">2. Step-by-Step Implementation Plan</h2>
<ol>
<li><strong>Database Setup:</strong> Verify <code>users</code> and <code>user_profiles</code> tables exist (see Schema).</li>
<li><strong>API Layer:</strong> Implement REST endpoints in <code>backend/src/routes/userRoutes.ts</code>.</li>
<li><strong>Service Layer:</strong> Create business logic in <code>backend/src/services/userService.ts</code>.</li>
<li><strong>MCP Tooling:</strong> Define MCP tools in <code>backend/src/mcp/user-tools.ts</code>.</li>
<li><strong>Validation:</strong> Implement Zod schemas for input validation.</li>
<li><strong>Testing:</strong> Write unit and integration tests.</li>
</ol>
<h2 id="3-schema--migration">3. Schema &amp; Migration</h2>
<p>Based on <code>backend/src/migrations/edulearn_migrations_script.sql</code>:</p>
<h3 id="users-table-users">Users Table (<code>users</code>)</h3>
<table>
<thead>
<tr>
<th style="text-align:left">Column</th>
<th style="text-align:left">Type</th>
<th style="text-align:left">Constraints</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>id</code></td>
<td style="text-align:left">UUID</td>
<td style="text-align:left">PK, Default: <code>gen_random_uuid()</code></td>
<td style="text-align:left">Unique user identifier</td>
</tr>
<tr>
<td style="text-align:left"><code>email</code></td>
<td style="text-align:left">VARCHAR(255)</td>
<td style="text-align:left">UNIQUE, NOT NULL</td>
<td style="text-align:left">User's email address</td>
</tr>
<tr>
<td style="text-align:left"><code>password_hash</code></td>
<td style="text-align:left">VARCHAR(255)</td>
<td style="text-align:left">NOT NULL</td>
<td style="text-align:left">Hashed password</td>
</tr>
<tr>
<td style="text-align:left"><code>first_name</code></td>
<td style="text-align:left">VARCHAR(100)</td>
<td style="text-align:left">NOT NULL</td>
<td style="text-align:left">First name</td>
</tr>
<tr>
<td style="text-align:left"><code>last_name</code></td>
<td style="text-align:left">VARCHAR(100)</td>
<td style="text-align:left">NOT NULL</td>
<td style="text-align:left">Last name</td>
</tr>
<tr>
<td style="text-align:left"><code>role</code></td>
<td style="text-align:left">ENUM</td>
<td style="text-align:left">NOT NULL</td>
<td style="text-align:left"><code>student</code>, <code>teacher</code>, <code>admin</code></td>
</tr>
<tr>
<td style="text-align:left"><code>is_active</code></td>
<td style="text-align:left">BOOLEAN</td>
<td style="text-align:left">Default: <code>true</code></td>
<td style="text-align:left">Account status</td>
</tr>
<tr>
<td style="text-align:left"><code>is_deleted</code></td>
<td style="text-align:left">BOOLEAN</td>
<td style="text-align:left">Default: <code>false</code></td>
<td style="text-align:left">Soft delete flag</td>
</tr>
<tr>
<td style="text-align:left"><code>deleted_at</code></td>
<td style="text-align:left">TIMESTAMP</td>
<td style="text-align:left">Nullable</td>
<td style="text-align:left">Timestamp of deletion</td>
</tr>
<tr>
<td style="text-align:left"><code>created_at</code></td>
<td style="text-align:left">TIMESTAMP</td>
<td style="text-align:left">Default: <code>NOW()</code></td>
<td style="text-align:left">Creation timestamp</td>
</tr>
<tr>
<td style="text-align:left"><code>updated_at</code></td>
<td style="text-align:left">TIMESTAMP</td>
<td style="text-align:left">Default: <code>NOW()</code></td>
<td style="text-align:left">Last update timestamp</td>
</tr>
</tbody>
</table>
<h3 id="user-profiles-table-userprofiles">User Profiles Table (<code>user_profiles</code>)</h3>
<table>
<thead>
<tr>
<th style="text-align:left">Column</th>
<th style="text-align:left">Type</th>
<th style="text-align:left">Constraints</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>id</code></td>
<td style="text-align:left">UUID</td>
<td style="text-align:left">PK</td>
<td style="text-align:left">Profile ID</td>
</tr>
<tr>
<td style="text-align:left"><code>user_id</code></td>
<td style="text-align:left">UUID</td>
<td style="text-align:left">FK -&gt; <code>users(id)</code></td>
<td style="text-align:left">Associated user</td>
</tr>
<tr>
<td style="text-align:left"><code>bio</code></td>
<td style="text-align:left">TEXT</td>
<td style="text-align:left">Nullable</td>
<td style="text-align:left">User biography</td>
</tr>
<tr>
<td style="text-align:left"><code>skills</code></td>
<td style="text-align:left">JSON</td>
<td style="text-align:left">Nullable</td>
<td style="text-align:left">List of skills</td>
</tr>
<tr>
<td style="text-align:left"><code>experience_level</code></td>
<td style="text-align:left">ENUM</td>
<td style="text-align:left">Default: <code>beginner</code></td>
<td style="text-align:left"><code>beginner</code>, <code>intermediate</code>, <code>advanced</code></td>
</tr>
</tbody>
</table>
<h2 id="4-api-design">4. API Design</h2>
<h3 id="base-url-apiv1users">Base URL: <code>/api/v1/users</code></h3>
<table>
<thead>
<tr>
<th style="text-align:left">Method</th>
<th style="text-align:left">Endpoint</th>
<th style="text-align:left">Description</th>
<th style="text-align:left">Access</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>POST</code></td>
<td style="text-align:left"><code>/</code></td>
<td style="text-align:left">Create a new user</td>
<td style="text-align:left">Admin</td>
</tr>
<tr>
<td style="text-align:left"><code>GET</code></td>
<td style="text-align:left"><code>/</code></td>
<td style="text-align:left">List all users (with pagination &amp; filters)</td>
<td style="text-align:left">Admin</td>
</tr>
<tr>
<td style="text-align:left"><code>GET</code></td>
<td style="text-align:left"><code>/:id</code></td>
<td style="text-align:left">Get user details</td>
<td style="text-align:left">Admin, Self</td>
</tr>
<tr>
<td style="text-align:left"><code>PUT</code></td>
<td style="text-align:left"><code>/:id</code></td>
<td style="text-align:left">Update user details</td>
<td style="text-align:left">Admin, Self</td>
</tr>
<tr>
<td style="text-align:left"><code>DELETE</code></td>
<td style="text-align:left"><code>/:id</code></td>
<td style="text-align:left">Soft delete user</td>
<td style="text-align:left">Admin</td>
</tr>
<tr>
<td style="text-align:left"><code>POST</code></td>
<td style="text-align:left"><code>/import</code></td>
<td style="text-align:left">Bulk import users from CSV</td>
<td style="text-align:left">Admin</td>
</tr>
<tr>
<td style="text-align:left"><code>GET</code></td>
<td style="text-align:left"><code>/export</code></td>
<td style="text-align:left">Export users to CSV</td>
<td style="text-align:left">Admin</td>
</tr>
</tbody>
</table>
<h2 id="5-mcp-tool-functions">5. MCP Tool Functions</h2>
<p>These tools will be exposed to the MCP client (e.g., the AI agent).</p>
<h3 id="createuser"><code>create_user</code></h3>
<ul>
<li><strong>Description:</strong> Creates a new user in the system.</li>
<li><strong>Arguments:</strong>
<ul>
<li><code>email</code> (string): Valid email address.</li>
<li><code>firstName</code> (string): User's first name.</li>
<li><code>lastName</code> (string): User's last name.</li>
<li><code>role</code> (string): 'student', 'teacher', or 'admin'.</li>
<li><code>password</code> (string, optional): Initial password (auto-generated if missing).</li>
</ul>
</li>
</ul>
<h3 id="getuser"><code>get_user</code></h3>
<ul>
<li><strong>Description:</strong> Retrieves a user by ID or Email.</li>
<li><strong>Arguments:</strong>
<ul>
<li><code>identifier</code> (string): UUID or Email address.</li>
</ul>
</li>
</ul>
<h3 id="updateuser"><code>update_user</code></h3>
<ul>
<li><strong>Description:</strong> Updates an existing user's information.</li>
<li><strong>Arguments:</strong>
<ul>
<li><code>id</code> (string): User UUID.</li>
<li><code>updates</code> (object): Fields to update (e.g., <code>{ firstName: 'John' }</code>).</li>
</ul>
</li>
</ul>
<h3 id="deleteuser"><code>delete_user</code></h3>
<ul>
<li><strong>Description:</strong> Soft deletes a user.</li>
<li><strong>Arguments:</strong>
<ul>
<li><code>id</code> (string): User UUID.</li>
</ul>
</li>
</ul>
<h3 id="searchusers"><code>search_users</code></h3>
<ul>
<li><strong>Description:</strong> Searches for users based on criteria.</li>
<li><strong>Arguments:</strong>
<ul>
<li><code>query</code> (string): Search term (name or email).</li>
<li><code>role</code> (string, optional): Filter by role.</li>
<li><code>isActive</code> (boolean, optional): Filter by status.</li>
</ul>
</li>
</ul>
<h2 id="6-validation-rules-zod">6. Validation Rules (Zod)</h2>
<pre class="hljs"><code><div><span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> <span class="hljs-string">'zod'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> CreateUserSchema = z.object({
  email: z.string().email(),
  firstName: z.string().min(<span class="hljs-number">2</span>),
  lastName: z.string().min(<span class="hljs-number">2</span>),
  role: z.enum([<span class="hljs-string">'student'</span>, <span class="hljs-string">'teacher'</span>, <span class="hljs-string">'admin'</span>]),
  password: z.string().min(<span class="hljs-number">8</span>).optional(),
});

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> UpdateUserSchema = z.object({
  email: z.string().email().optional(),
  firstName: z.string().min(<span class="hljs-number">2</span>).optional(),
  lastName: z.string().min(<span class="hljs-number">2</span>).optional(),
  role: z.enum([<span class="hljs-string">'student'</span>, <span class="hljs-string">'teacher'</span>, <span class="hljs-string">'admin'</span>]).optional(),
  isActive: z.boolean().optional(),
});
</div></code></pre>
<h2 id="7-csv-import-logic">7. CSV Import Logic</h2>
<ol>
<li><strong>Upload:</strong> Admin uploads a CSV file to <code>POST /users/import</code>.</li>
<li><strong>Parsing:</strong> Server parses CSV using a library like <code>papaparse</code> or <code>csv-parser</code>.</li>
<li><strong>Validation:</strong> Each row is validated against <code>CreateUserSchema</code>.</li>
<li><strong>Dry Run:</strong> If <code>dryRun=true</code>, return a summary of valid/invalid rows without saving.</li>
<li><strong>Execution:</strong> If valid, insert users in a transaction.</li>
<li><strong>Result:</strong> Return a report: <code>{ total: 100, success: 98, failed: 2, errors: [...] }</code>.</li>
</ol>
<h2 id="8-rbac-rules">8. RBAC Rules</h2>
<table>
<thead>
<tr>
<th style="text-align:left">Action</th>
<th style="text-align:center">Admin</th>
<th style="text-align:center">Teacher</th>
<th style="text-align:center">Student</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Create User</td>
<td style="text-align:center">✅</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
</tr>
<tr>
<td style="text-align:left">Read Any User</td>
<td style="text-align:center">✅</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
</tr>
<tr>
<td style="text-align:left">Read Self</td>
<td style="text-align:center">✅</td>
<td style="text-align:center">✅</td>
<td style="text-align:center">✅</td>
</tr>
<tr>
<td style="text-align:left">Update Any User</td>
<td style="text-align:center">✅</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
</tr>
<tr>
<td style="text-align:left">Update Self</td>
<td style="text-align:center">✅</td>
<td style="text-align:center">✅</td>
<td style="text-align:center">✅</td>
</tr>
<tr>
<td style="text-align:left">Delete User</td>
<td style="text-align:center">✅</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
</tr>
<tr>
<td style="text-align:left">Import/Export</td>
<td style="text-align:center">✅</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
</tr>
</tbody>
</table>
<h2 id="9-test-plan">9. Test Plan</h2>
<ul>
<li><strong>Unit Tests:</strong>
<ul>
<li>Test validation logic (valid/invalid emails, roles).</li>
<li>Test service methods (create, update, delete).</li>
</ul>
</li>
<li><strong>Integration Tests:</strong>
<ul>
<li>Test API endpoints with a test database.</li>
<li>Verify RBAC enforcement (e.g., student trying to delete a user).</li>
<li>Test CSV import with various file formats (valid, invalid, mixed).</li>
</ul>
</li>
<li><strong>MCP Tool Tests:</strong>
<ul>
<li>Verify MCP tools correctly map to service methods.</li>
</ul>
</li>
</ul>

</body>
</html>
